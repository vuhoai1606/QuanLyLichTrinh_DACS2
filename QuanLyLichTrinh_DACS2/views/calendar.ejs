<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Calendar - Manage your events and tasks visually" />
  
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/calendar.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />

  <title>Calendar</title>
</head>
<body>
  <%- include('header') %>

  <div class="main-container">

    <!-- Calendar Header -->
    <div class="calendar-header">
      <div class="left-controls">
        <button onclick="prevPeriod()" class="btn-secondary">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button onclick="today()" class="btn-secondary">Today</button>
        <button onclick="nextPeriod()" class="btn-secondary">
          <i class="fas fa-chevron-right"></i>
        </button>

        <h2 id="month-year">Loading...</h2>

        <!-- View Mode Selector (English) -->
        <select id="viewMode" onchange="changeView()" class="view-select">
          <option value="month">Month</option>
          <option value="week">Week</option>
          <option value="day">Day</option>
          <option value="year">Year</option>
        </select>
      </div>

      <div class="right-controls">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="search" placeholder="Search events..." oninput="searchEvents(this.value)">
        </div>
      </div>
    </div>

    <!-- Calendar Body -->
    <div class="calendar-body">
      <!-- Main Calendar -->
      <div class="calendar-main">
        <!-- Weekdays: Monday → Sunday (International standard)  -->

        <div id="calendar-wrapper">
          <div class="calendar-grid" id="calendar">
            <!-- Days will be rendered here by JS -->
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <aside class="calendar-sidebar">
        <button class="create-btn btn-primary" onclick="openCreateModal()">
          <i class="fas fa-plus"></i> New Event
        </button>

        <div class="card time-insights">
          <h3>Time Insights</h3>
          <div id="timeInsightsContent">Loading...</div>
        </div>

        <div class="card my-calendar">
          <h3>My Calendars</h3>
          <div class="calendar-list">
            <label><input type="checkbox" checked> Personal</label>
            <label><input type="checkbox"> Work</label>
          </div>
        </div>

        <!-- PHẦN PHÂN LOẠI SỰ KIỆN - SIÊU ĐẸP -->
        <div class="card" style="margin-top: 16px;">
          <h3 style="margin: 0 0 16px 0; color: #000;">
            <i class="fas fa-tags"></i> Phân loại sự kiện
          </h3>
          <div id="event-categories">
            <label class="category-item">
              <input type="checkbox" value="work" checked>
              <span class="category-color" style="background: #8b5cf6;"></span>
              <span class="category-name">Công việc</span>
            </label>
            <label class="category-item">
              <input type="checkbox" value="personal" checked>
              <span class="category-color" style="background: #ec4899;"></span>
              <span class="category-name">Cá nhân</span>
            </label>
            <label class="category-item">
              <input type="checkbox" value="meeting" checked>
              <span class="category-color" style="background: #3b82f6;"></span>
              <span class="category-name">Họp hành</span>
            </label>
            <label class="category-item">
              <input type="checkbox" value="birthday" checked>
              <span class="category-color" style="background: #10b981;"></span>
              <span class="category-name">Sinh nhật</span>
            </label>
            <label class="category-item">
              <input type="checkbox" value="holiday" checked>
              <span class="category-color" style="background: #f59e0b;"></span>
              <span class="category-name">Nghỉ lễ</span>
            </label>
          </div>
        </div>

        <div class="card upcoming-events">
          <h3>Upcoming</h3>
          <ul id="upcomingList"><li>Loading...</li></ul>
        </div>

        <div class="event-actions">
          <button id="edit-event" class="btn-secondary" style="display:none;">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button id="delete-event" class="btn-secondary" style="display:none;">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>

        <div class="card share-group">
          <h3>Calendar Options</h3>

          <button id="share-calendar" class="btn-secondary" style="width: 100%; margin-bottom: 10px;">
            <i class="fas fa-share-alt"></i> Share Calendar
          </button>

          <label for="group-calendar">Group Calendar</label>
          <select id="group-calendar" class="view-select" style="width: 100%; margin-top: 6px;">
            <option value="personal">Personal</option>
            <option value="team">Team</option>
            <option value="work">Work</option>
          </select>
        </div>

        <button class="btn-secondary" onclick="window.location.href='/timeline'" style="width:100%; margin-bottom: 15px;">
          <i class="fas fa-chart-gantt"></i> Timeline View
        </button>

      </aside>
    </div>
  </div>

  <!-- Event Modal -->
  <div class="modal" id="eventModal">
    <div class="modal-content">
      <h3 id="modalTitle">New Event</h3>
      
      <!-- Type Selector -->
      <label>Type</label>
      <select id="eventType" class="view-select">
        <option value="event">Event</option>
        <option value="task">Task</option>
        <option value="sprint">Sprint</option>
      </select>

      <!-- Color Picker -->
      <label style="margin-top:10px;">Color</label>
      <input type="color" id="eventColor" value="#4285f4" style="width: 100%; height: 40px; border: none; cursor: pointer;">

      <input type="text" id="eventTitle" placeholder="Event title" required>
      <textarea id="eventDesc" rows="3" placeholder="Description (optional)..."></textarea>
      
      <div class="datetime-group">
        <div>
          <label>Start</label>
          <input type="datetime-local" id="eventStart" required>
        </div>
        <div>
          <label>End</label>
          <input type="datetime-local" id="eventEnd">
        </div>
      </div>

      <label class="checkbox-label">
        <input type="checkbox" id="eventAllDay"> All day
      </label>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeEventModal()">Cancel</button>
        <button type="button" class="btn-primary" onclick="saveEvent()">Save</button>
      </div>

      <div class="modal" id="shareModal">
        <div class="modal-content" style="width: 500px;">
          <h3 style="text-align: left;"><i class="fas fa-share-alt"></i> Share Calendar</h3>
          
          <label>Invite by Email</label>
          <input type="email" id="shareEmail" placeholder="Enter email address...">
          <button type="button" class="btn-primary" onclick="sendShareInvite()" style="margin-bottom: 20px; width: 100%;">
              <i class="fas fa-paper-plane"></i> Send Invitation
          </button>

          <h4 style="margin-bottom: 10px; color: var(--text-dark); font-size: 16px;">Or Share Link</h4>
          <div style="display: flex; gap: 10px;">
              <input type="text" id="shareLink" readonly value="Click to generate link">
              <button type="button" class="btn-secondary" onclick="generateShareLink()">
                  <i class="fas fa-link"></i> Generate
              </button>
          </div>

          <div class="modal-actions" style="justify-content: flex-end; margin-top: 20px;">
            <button type="button" class="btn-secondary" onclick="closeShareModal()">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/calendar.js"></script>
  <script src="/js/header.js"></script>
</body>
</html>