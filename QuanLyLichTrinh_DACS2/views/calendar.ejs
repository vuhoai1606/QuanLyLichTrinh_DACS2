<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Calendar - Manage your events and tasks visually" />
  <%- include('theme-support') %>
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/calendar.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />

  <title>Calendar</title>
</head>
<body>
  <%- include('header') %>

  <div class="main-container">

    <div class="calendar-header">
      <div class="left-controls">
        <button onclick="prevPeriod()" class="btn-secondary">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button onclick="today()" class="btn-secondary">Today</button>
        <button onclick="nextPeriod()" class="btn-secondary">
          <i class="fas fa-chevron-right"></i>
        </button>

        <h2 id="month-year">Loading...</h2>

        <select id="viewMode" onchange="changeView()" class="view-select">
          <option value="month">Month</option>
          <option value="week">Week</option>
          <option value="day">Day</option>
          <option value="year">Year</option>
        </select>
      </div>

      <div class="right-controls">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="search" placeholder="Search events..." oninput="window.filterAndDisplayEvents(this.value)">
        </div>
      </div>
    </div>

    <div class="calendar-body">
      <div class="calendar-main">
        <div id="calendar-wrapper">
          <div class="weekdays" id="weekdays-header">
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
            <div>Sun</div>
          </div>
          <div class="calendar-grid" id="calendar">
            </div>
        </div>
      </div>

      <aside class="calendar-sidebar">
        <button class="create-btn btn-primary" onclick="openCreateModal()">
          <i class="fas fa-plus"></i> New Event
        </button>

        <div class="card time-insights">
          <h3>Time Insights</h3>
          <div id="timeInsightsContent">Loading...</div>
        </div>

        <div class="card event-filter-card">
          <h3><i class="fas fa-tags"></i> Event Categories</h3> 
          
          <div id="event-categories" style="display: flex; flex-direction: column; gap: 14px;">
            <label class="category-item">
              <input type="checkbox" value="Personal" checked> 
              <span class="category-color" style="background:#4285f4;"></span> Personal
            </label>
            <label class="category-item">
              <input type="checkbox" value="Work" checked> 
              <span class="category-color" style="background:#f59e0b;"></span> Work
            </label>

            <div class="divider" style="margin: 10px 0;"></div>

            <label class="category-item">
              <input type="checkbox" value="Meeting" checked>
              <span class="category-color" style="background: #8b5cf6;"></span>
              <span class="category-name">Meeting</span>
            </label>
            <label class="category-item">
              <input type="checkbox" value="Birthday" checked>
              <span class="category-color" style="background: #ec4899;"></span>
              <span class="category-name">Birthday</span>
            </label>
            <label class="category-item">
              <input type="checkbox" value="Holiday" checked>
              <span class="category-color" style="background: #3b82f6;"></span>
              <span class="category-name">Holiday</span>
            </label>
          </div>
        </div>
        <div class="card upcoming-events">
          <h3>Upcoming</h3>
          <ul id="upcomingList"><li>Loading...</li></ul>
        </div>

        <div class="event-actions">
          <button id="edit-event" class="btn-secondary" style="display:none;">
            <i class="fas fa-edit"></i> Edit
          </button>
          <button id="delete-event" class="btn-secondary" style="display:none;">
            <i class="fas fa-trash"></i> Delete
          </button>
        </div>

        <div class="card share-group">
          <h3>Calendar Options</h3>

          <button id="share-calendar" class="btn-secondary" style="width: 100%; margin-bottom: 10px;">
            <i class="fas fa-share-alt"></i> Share Calendar
          </button>

          <label for="group-calendar">Group Calendar</label>
          <select id="group-calendar" class="view-select" onchange="loadEvents()" style="width: 100%; margin-top: 6px; ">
            <option value="personal">Personal</option>
            <option value="team">Team</option>
            <option value="work">Work</option>
          </select>
        </div>

        <!-- <button class="btn-secondary" onclick="window.location.href='/timeline'" style="width:100%; margin-bottom: 15px;">
          <i class="fas fa-chart-gantt"></i> Timeline View
        </button> -->

      </aside>
    </div>
  </div>

  <div class="modal" id="eventModal">
    <div class="modal-content">
      <h3 id="modalTitle">New Event</h3>
      
      <label>Type</label>
      <select id="eventType" class="view-select">
        <option value="event">Event</option>
        <option value="task">Task</option>
        <option value="sprint">Sprint</option>
      </select>

      <label for="eventCalendar" style="margin-top:10px;">Calendar/Category:</label>
      <select id="eventCalendar" class="view-select">
        <option value="Personal" data-color="#4285f4">Personal</option>
        <option value="Work" data-color="#f59e0b">Work</option>
        <option value="Meeting" data-color="#8b5cf6">Meeting</option>
        <option value="Birthday" data-color="#ec4899">Birthday</option>
        <option value="Holiday" data-color="#3b82f6">Holiday</option>
      </select>
      <input type="text" id="eventTitle" placeholder="Event title" required>
      <textarea id="eventDesc" rows="3" placeholder="Description (optional)..."></textarea>
      
      <div class="datetime-group">
        <div>
          <label>Start</label>
          <input type="datetime-local" id="eventStart" required>
        </div>
        <div>
          <label>End</label>
          <input type="datetime-local" id="eventEnd"> 
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeEventModal()">Cancel</button>
        <button type="button" class="btn-primary" onclick="saveEvent()">Save</button>
      </div>
      
      </div>
  </div>
  <div class="modal" id="shareModal">
    <div class="modal-content" style="width: 500px;">
      <h3 style="text-align: left;"><i class="fas fa-share-alt"></i> Share Calendar</h3>
      
      <label>Invite by Email</label>
      <input type="email" id="shareEmail" placeholder="Enter email address...">
      <button type="button" class="btn-primary" onclick="sendShareInvite()" style="margin-bottom: 20px; width: 100%;">
          <i class="fas fa-paper-plane"></i> Send Invitation
      </button>

      <h4 style="margin-bottom: 10px; color: var(--text-dark); font-size: 16px;">Or Share Link</h4>
      <div style="display: flex; gap: 10px;">
          <input type="text" id="shareLink" readonly value="Click to generate link">
          <button type="button" class="btn-secondary" onclick="generateShareLink()">
              <i class="fas fa-link"></i> Generate
          </button>
      </div>

      <div class="modal-actions" style="justify-content: flex-end; margin-top: 20px;">
        <button type="button" class="btn-secondary" onclick="closeShareModal()">Close</button>
      </div>
    </div>
  </div>
  <script src="/js/calendar.js"></script>
  <script src="/js/header.js"></script>
</body>
</html>